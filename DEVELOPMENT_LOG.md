# DEVELOPMENT_LOG.md

이 문서는 Gemini CLI와의 "Vibe Coding" (프롬프트 기반 개발)을 통해 '자취생을 위한 식단 관리 앱'을 개발한 과정을 요약합니다.

---

## 1단계: 프로젝트 기획 및 백엔드 뼈대 (Backend Scaffolding)

**목표:** Node.js, Express, MongoDB를 사용하여 앱의 핵심 백엔드 구조를 설계했습니다.

**과정:**
처음에는 전체 요구사항을 담은 큰 `GEMINI.md` 파일을 만들었으나, CLI가 처리하기에 너무 커서 4개의 작은 프롬프트로 분할하여 순차적으로 요청했습니다.

**사용한 프롬프트 요약:**

1.  **"프로젝트 폴더 구조 요청"**: `backend/`와 `frontend/`를 분리한 모노레포 구조를 요청했습니다.
2.  **"Mongoose 스키마 요청"**: `FoodItem`(식품 마스터), `Inventory`(내 재고), `MealLog`(식사 기록) 3가지 DB 스키마 코드를 요청했습니다.
3.  **"API 엔드포인트 설계 요청"**: CRUD, 식단 추천, 재고 차감 등 6가지 핵심 기능을 위한 API 라우트 목록 설계를 요청했습니다.
4.  **"식단 추천 로직 요청"**: 재고 기반으로 식단을 조합하는 백엔드 알고리즘의 슈도코드를 요청했습니다.

---

## 2단계: 개발 환경 설정 및 디버깅 (Environment Setup)

**목표:** 로컬 개발 환경에 Gemini CLI, Node.js(nvm), MongoDB를 설치했습니다.

**과정:**
`npm` 명령어를 찾지 못하는 오류가 발생하여, `nvm`을 먼저 설치했습니다. 이후 VS Code를 재시작할 때마다 `nvm` 경로가 사라지는 문제가 발생하여, `.bash_profile` 및 `.bashrc` (또는 `.zshrc`) 설정 파일을 수정하여 터미널이 셸(shell) 시작 시 `nvm`을 자동으로 불러오도록 영구 설정했습니다.

**사용한 프롬프트 요약:**

* **"npm not found 라고 뜨는 이유가 뭐야?"**

---

## 3단계: 프론트엔드 UI 뼈대 (Frontend UI Scaffolding)

**목표:** 사용자가 제공한 UI 이미지와 유사하게 React 컴포넌트 뼈대를 구축했습니다.

**과정:**
UI 이미지를 기반으로 프롬프트를 작성했으나, 이 역시 CLI가 한 번에 처리하기에 너무 커서 5단계로 분할하여 개별 컴포넌트를 먼저 생성하고 마지막에 조립했습니다.

**사용한 프롬프트 요약:**

1.  **"CalorieCircle.js 요청"**: 상단 원형 칼로리 프로그레스 바 UI를 요청했습니다.
2.  **"NutrientBars.js 요청"**: 중단 영양소(단백질, 지방, 나트륨) 막대 바 UI를 요청했습니다.
3.  **"MealList.js 요청"**: 하단 식사(아침, 점심, 저녁) 목록 카드 UI를 요청했습니다.
4.  **"FooterNav.js 요청"**: 최하단 네비게이션 탭 바 UI를 요청했습니다.
5.  **"Dashboard.js (조립) 요청"**: 위 4개의 컴포넌트를 import하여 메인 페이지를 완성하도록 요청했습니다.

---

## 4단계: 핵심 기능 1 - 재고 관리 및 페이지 연동 (Inventory & Routing)

**목표:** '재고 추가' 기능을 만들고, `react-router-dom`을 도입하여 메인 대시보드와 재고 페이지를 분리 및 연동했습니다.

**과정:**
단순한 UI에서 실제 기능 연동으로 넘어갔습니다. 재고 관리를 위한 새 페이지(`InventoryPage.js`)를 요청하고, 하단 네비게이션(`FooterNav.js`)을 클릭하여 페이지 간 이동이 가능하도록 `App.js`에서 라우팅 설정을 하도록 요청했습니다.

**사용한 프롬프트 요약:**

* **"재고 관리 페이지(InventoryPage.js) UI 요청"**: 재료 추가 폼과 현재 재고 목록을 보여주는 페이지 생성을 요청했습니다.
* **"react-router-dom 설치 및 App.js 설정 요청"**: `/` (메인), `/inventory` (재고) 경로를 설정하는 라우터 생성을 요청했습니다.
* **"FooterNav.js 링크 수정 요청"**: 단순 버튼이었던 하단 탭을 `<Link>`로 교체하여 페이지 이동 기능을 넣도록 요청했습니다.

---

## 5단계: 핵심 기능 2 - 지능형 식단 추천 (Smart Recommendation)

**목표:** 재고 기반 식단 추천, 부족 영양소 추천, 재료 추가 시 영양소 자동 완성 기능을 구현했습니다.

**과정:**
백엔드 API와 프론트엔드 UI를 동시에 요청하며 기능을 고도화했습니다.

**사용한 프롬프트 요약:**

1.  **"식단 추천 기능 연동 요청"**: `MealList.js`에 '추천받기' 버튼을 추가하고, 백엔드 API를 호출해 조합을 받아오도록 요청했습니다.
2.  **"부족 영양소 및 가성비 재료 추천 요청"**: `GET /api/nutrition/recommendations` API와 이를 보여줄 `NutritionGap.js` 컴포넌트 생성을 요청했습니다.
3.  **"재료 추가 시 영양소 자동 저장 요청"**: `POST /api/fooditems/fetch` API를 만들어, 사용자가 새 재료를 입력하면 백엔드가 **외부 API에서 영양 정보를 가져와** DB에 저장하도록 요청했습니다.
4.  **"재료 추가 시 실시간 영양소 표시 요청"**: `GET /api/fooditems/search` API와 '실시간 검색 UI'를 요청하여, 사용자가 재료 이름을 타이핑하면 즉시 DB에서 영양소 정보를 보여주도록 `InventoryPage.js` 수정을 요청했습니다.

---


## 6단계: 핵심 기능. '이번 주' 통계 기능 수정

*   **요구사항:** '이번 주' 탭의 칼로리 합산 방식을 '현재 날짜 기준 최근 7일'로 변경하고, 누적된 값을 초기화하는 작업을 진행했습니다.
*   **해결 과정:**
    1.  `statisticsController.js`의 `getWeeklyStats` 함수 로직을 수정하여, 고정된 주(월~일)가 아닌 최근 7일간의 데이터를 조회하도록 변경했습니다.
    2.  잘못된 데이터가 계속 표시되는 문제를 해결하기 위해, 일회성으로 이번 주 데이터를 삭제하는 스크립트를 작성하고 실행하여 데이터베이스를 정리했습니다.

## 2. '식사 기록 취소' 기능 구현 (백엔드)

*   **요구사항:** 사용자가 기록한 식사를 취소할 수 있는 API를 개발했습니다.
*   **해결 과정:**
    1.  `DELETE /api/log/:logId` API 엔드포인트를 설계했습니다.
    2.  `mealLogController.js`에 `deleteMealLog` 함수를 구현했습니다. 이 기능은 다음 두 가지 작업을 수행합니다.
        *   취소된 식단에 포함된 재료를 `Inventory` 컬렉션에 다시 추가 (재고 복구)
        *   `MealLog` 컬렉션에서 해당 식사 기록 삭제
    3.  초기에는 두 작업을 트랜잭션으로 묶었으나, 독립 실행형 MongoDB 환경과의 호환성 문제(500 에러 발생)를 해결하기 위해 트랜잭션을 제거하는 방식으로 코드를 수정했습니다.

## 3. '설정' 페이지 및 UI 구현 (프론트엔드)

*   **요구사항:** '식사 기록 취소' 기능을 사용자가 직접 이용할 수 있도록 UI를 개발했습니다.
*   **해결 과정:**
    1.  모든 식사 기록을 가져오는 `GET /api/log/all` API를 백엔드에 추가했습니다.
    2.  `SettingsPage.js` 컴포넌트를 새로 생성하여, 위 API로 모든 식사 기록을 불러와 목록으로 표시했습니다.
    3.  각 기록 옆에 '기록 취소' 버튼을 만들고, 백엔드의 `DELETE /api/log/:logId` API와 연동했습니다.
    4.  `App.js`에 `/settings` 경로를 추가하여 이 페이지가 표시되도록 설정했습니다.

## 4. 사용자 맞춤 설정 기능 추가

*   **요구사항:** 사용자가 직접 '일일 목표 칼로리'와 '영양소 목표'를 설정하고 저장하는 기능을 추가했습니다.
*   **해결 과정:**
    1.  **백엔드:**
        *   사용자 설정값을 저장할 `UserPreferences` Mongoose 스키마를 새로 만들었습니다.
        *   설정값을 가져오고(`GET /api/preferences`), 업데이트하는(`PUT /api/preferences`) API를 구현했습니다.
    2.  **프론트엔드:**
        *   `SettingsPage.js`에 '내 목표 설정' 섹션을 추가했습니다.
        *   사용자가 목표치를 입력할 수 있는 폼(input)과 '저장' 버튼을 만들고, `PUT /api/preferences` API와 연동했습니다.

## 5. 주요 버그 수정 및 안정화

개발 과정에서 발생한 여러 버그를 해결하며 서비스 안정성을 높였습니다.

*   **API 경로 불일치 (404 에러):** 프론트엔드와 백엔드의 API 경로가 일치하지 않는 문제를 발견하고, 백엔드 라우팅 설정을 `/api/log`로 통일하여 해결했습니다.
*   **날짜 표시 오류:** 모든 식사 기록이 오늘 날짜로만 표시되는 문제를 해결했습니다. 식사를 기록할 때, 선택된 날짜(`selectedDate`) 정보가 누락되었던 것이 원인이었으며, 날짜 정보가 API를 통해 정확히 전달되도록 `Dashboard.js`와 `MealList.js`를 수정했습니다.
*   **'식습관 관리' 탭 미반영:** '설정' 페이지에서 식사 기록을 삭제해도 메인 화면('식습관 관리' 탭)에 즉시 반영되지 않는 문제를 해결했습니다. 기록 삭제 시, 데이터베이스뿐만 아니라 브라우저의 `localStorage`에 저장된 데이터도 함께 삭제하도록 `SettingsPage.js`를 수정했습니다.

## 6. 프로젝트 제출용 문서 작성

*   **요구사항:** 과제 제출을 위해, 다른 사람도 프로젝트를 쉽게 실행할 수 있도록 안내 문서를 작성했습니다.
*   **해결 과정:**
    *   프로젝트 소개, 필수 설치 항목(Node.js, MongoDB), 백엔드/프론트엔드 실행 방법을 상세히 기술한 `README.md` 파일을 작성하고 프로젝트에 추가했습니다.

## 7단계: MongoDB Atlas 클라우드 DB 연결 및 디버깅

**목표:** 로컬 MongoDB 대신 MongoDB Atlas 클라우드 데이터베이스에 연결하도록 프로젝트를 설정하고 발생하는 문제를 해결했습니다.

**과정:**
프로젝트를 다른 환경(교수님 컴퓨터)에서 실행할 때 로컬 DB 의존성 문제를 해결하기 위해 클라우드 DB 연결을 시도했습니다.

1.  **클라우드 DB 설정:** MongoDB Atlas에 계정을 생성하고 무료 클러스터를 설정했습니다. 데이터베이스 사용자 생성 및 네트워크 접근(IP 허용 목록) 설정을 진행했습니다.
2.  **연결 문자열 (`MONGO_URI`) 설정:** Atlas에서 제공하는 연결 문자열을 복사하여 백엔드 프로젝트의 `.env` 파일에 `MONGO_URI` 환경 변수로 설정했습니다.
3.  **초기 오류 - `Error: bad auth : authentication failed`:**
    *   `.env` 파일에 비밀번호를 잘못 입력했거나, 비밀번호에 특수문자가 포함되어 `dotenv` 라이브러리가 제대로 파싱하지 못하는 문제로 진단했습니다.
    *   비밀번호를 재설정하고 `.env` 파일의 문자열을 큰따옴표로 감싸는 등의 시도를 했습니다.
4.  **다음 오류 - `Error: querySrv EBADNAME _mongodb._tcp.`:**
    *   이 오류는 DNS(Domain Name System) 조회 실패로, 연결 문자열의 서버 주소(호스트 이름)에 오타가 있거나 네트워크에서 해당 주소를 찾지 못할 때 발생합니다.
    *   `nslookup`, `dig`, `getent hosts` 명령어를 통해 사용자 컴퓨터가 Atlas 서버 주소를 찾을 수 있는지 테스트했습니다. 이 테스트들은 `command not found` 또는 `Exit Code: 2`로 실패하여, 사용자 컴퓨터가 해당 주소를 찾지 못하고 있음을 확인했습니다.
    *   사용자가 Atlas에서 복사한 호스트 이름(`cluster0.iwlq1ae.mongodb.net`)을 직접 테스트했으나 여전히 실패하여, 호스트 이름 자체의 오타 가능성에 집중했습니다.
5.  **문제의 원인 발견 - `.env` 파일의 오타:**
    *   `.env` 파일의 문제인지 확인하기 위해, `db.js` 파일에 연결 문자열을 **하드코딩**하여 테스트했습니다. 이 방법으로 연결이 성공하여, `.env` 파일에 문제가 있음을 확신했습니다.
    *   최종적으로 `.env` 파일에 `MONGO_URI=mongodb+srv://hyangsh92:<비밀번호>@...` 형식에서 **비밀번호를 감싸고 있던 `<`와 `>` 괄호가 문제**였음을 발견했습니다. `dotenv` 라이브러리가 이 괄호까지 비밀번호의 일부로 인식하여 인증에 실패했던 것입니다.
6.  **해결:** `.env` 파일에서 비밀번호를 감싸던 `<`와 `>` 괄호를 제거하고, `db.js` 파일을 다시 `.env`를 사용하도록 원상 복구하여 문제를 최종적으로 해결했습니다.

**교훈:** `.env` 파일에 민감 정보를 설정할 때는 정확한 형식과 문자열을 사용해야 하며, 특히 템플릿에서 복사할 때 불필요한 괄호나 특수문자가 포함되지 않도록 주의해야 합니다.